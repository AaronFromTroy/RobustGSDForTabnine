---
phase: 04-advanced-features
plan: 03
type: execute
wave: 3
depends_on: [04-02]
files_modified:
  - gsd/guidelines/research.md
  - gsd/scripts/researcher.js
  - gsd/scripts/integration-test.js
autonomous: true

must_haves:
  truths:
    - "System can perform web searches to gather research findings automatically"
    - "User can provide manual research findings or use automated research"
    - "Research findings from web searches include source URLs and content"
    - "Automated research integrates with existing research-synthesizer.js"
  artifacts:
    - path: "gsd/guidelines/research.md"
      provides: "Research workflow guideline with step-by-step procedures"
      contains: "## Success Criteria"
    - path: "gsd/scripts/researcher.js"
      provides: "Automated research with web search integration"
      exports: ["performResearch", "extractFindings", "mergeManualFindings"]
      min_lines: 100
    - path: "gsd/scripts/integration-test.js"
      provides: "Test Suite 11: Automated research"
      contains: "Test Suite 11"
  key_links:
    - from: "gsd/scripts/researcher.js"
      to: "WebSearch"
      via: "performs web searches"
      pattern: "web search|fetch|search"
    - from: "gsd/scripts/researcher.js"
      to: "gsd/scripts/research-synthesizer.js"
      via: "import synthesizeResearch"
      pattern: "import.*research-synthesizer"
    - from: "gsd/guidelines/research.md"
      to: "gsd/scripts/researcher.js"
      via: "references researcher.js in workflow"
      pattern: "researcher\\.js"
---

<objective>
Add automated research capability that performs web searches and gathers findings, while still allowing manual research input.

Purpose: Enable both automated and manual research workflows, feeding findings into existing research-synthesizer.js for confidence scoring and document generation.

Output: Research workflow guideline, researcher.js script with web search integration, and Test Suite 11.
</objective>

<execution_context>
@C:\Users\acous\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\acous\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Projects\GSDForTabnine\.planning\PROJECT.md
@C:\Projects\GSDForTabnine\.planning\ROADMAP.md
@C:\Projects\GSDForTabnine\.planning\STATE.md
@C:\Projects\GSDForTabnine\.planning\phases\04-advanced-features\04-RESEARCH.md
@C:\Projects\GSDForTabnine\.planning\phases\04-advanced-features\04-02-SUMMARY.md
@C:\Projects\GSDForTabnine\gsd\scripts\research-synthesizer.js
@C:\Projects\GSDForTabnine\gsd\scripts\file-ops.js
@C:\Projects\GSDForTabnine\gsd\templates\STACK.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create research workflow guideline</name>
  <files>gsd/guidelines/research.md</files>
  <action>
Create research.md following the AGENTS.md pattern from existing guidelines (new-project.md, plan-phase.md, etc.).

The guideline must include:

**YAML Frontmatter:**
- workflow: research
- version: 1.0.0
- description: Conduct research on a topic with automated web search or manual input

**Six Core Sections (AGENTS.md pattern):**

1. **Objective** - What this workflow accomplishes
   - Gather research findings on a specified topic
   - Support both automated (web search) and manual research input
   - Assign confidence levels based on source authority
   - Generate structured research documents

2. **Context** - When to use this workflow
   - During new-project workflow to research stack/features/architecture
   - When exploring new technologies or patterns
   - Before making architectural decisions
   - When updating existing research with new findings

3. **Process** - Step-by-step workflow

   **Step 1: Define Research Scope**
   - Determine research topic (stack, features, architecture, pitfalls, or custom)
   - Identify key questions to answer
   - Decide: automated web search, manual input, or hybrid

   **Step 2: Gather Findings (Automated)**
   - If using automated research:
     - Use researcher.js performResearch(topic, type, options)
     - System performs 3-5 web searches per topic
     - Extracts findings with source URLs
     - Returns array of {title, content, source} objects

   **Step 3: Add Manual Findings (Optional)**
   - If providing manual research:
     - Use researcher.js mergeManualFindings(automated, manual)
     - Manual findings: [{title, content, source, verifiedWithOfficial: true}]
     - Set verifiedWithOfficial: true to boost confidence to MEDIUM

   **Step 4: Assign Confidence Levels**
   - System calls assignConfidenceLevel() for each finding
   - HIGH: official docs (docs.*, .dev, github.com/*/docs/)
   - MEDIUM: MDN, Stack Overflow, verified community sources
   - LOW: blogs, unverified sources

   **Step 5: Generate Research Document**
   - Call appropriate generate*Document() function
   - generateStackDocument() for technology stack
   - generateFeaturesDocument() for features
   - generateArchitectureDocument() for architecture
   - generatePitfallsDocument() for pitfalls
   - generateSummaryDocument() for aggregated summary

   **Step 6: Review and Iterate**
   - Review generated document in .planning/
   - If gaps exist, add manual findings and regenerate
   - Approve or request additional research

4. **Success Criteria** - How to know workflow completed successfully
   - [ ] Research findings gathered (automated and/or manual)
   - [ ] All findings include source URLs
   - [ ] Confidence levels assigned (HIGH/MEDIUM/LOW)
   - [ ] Research document generated in .planning/
   - [ ] Document includes confidence sections and source citations
   - [ ] User approves research quality

5. **Artifacts** - Expected outputs
   - .planning/STACK.md (if researching technology stack)
   - .planning/FEATURES.md (if researching features)
   - .planning/ARCHITECTURE.md (if researching architecture)
   - .planning/PITFALLS.md (if researching common mistakes)
   - .planning/RESEARCH-SUMMARY.md (if generating summary)

6. **Integration** - How this connects to other workflows
   - Called by new-project workflow during roadmap creation
   - Used before plan-phase workflow for architecture decisions
   - Results feed into approval-gate workflow for decision-making
   - Documents referenced in ROADMAP.md and STATE.md

**Example Usage:**
```javascript
// Automated research
const findings = await performResearch('React ecosystem', 'STACK', {
  maxSearches: 5,
  includeOfficialDocs: true
});

// Add manual findings
const manualFindings = [{
  title: 'React 19 Beta',
  content: 'New features include...',
  source: 'https://react.dev/blog/2024/react-19',
  verifiedWithOfficial: true
}];

const combined = mergeManualFindings(findings, manualFindings);

// Generate document
await generateStackDocument(projectRoot, combined);
```

Use affirmative phrasing (Phase 1 pattern). Include version metadata. Follow AGENTS.md six-section structure.
  </action>
  <verify>
Check file exists:
- ls gsd/guidelines/research.md

Verify AGENTS.md structure:
- grep "^---" gsd/guidelines/research.md (YAML frontmatter)
- grep "## Objective" gsd/guidelines/research.md
- grep "## Context" gsd/guidelines/research.md
- grep "## Process" gsd/guidelines/research.md
- grep "## Success Criteria" gsd/guidelines/research.md
- grep "## Artifacts" gsd/guidelines/research.md
- grep "## Integration" gsd/guidelines/research.md

Verify content:
- grep "performResearch" gsd/guidelines/research.md
- grep "mergeManualFindings" gsd/guidelines/research.md
  </verify>
  <done>
research.md exists with AGENTS.md six-section structure, step-by-step process for automated and manual research, success criteria, and integration points with existing workflows.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create researcher.js with web search integration</name>
  <files>gsd/scripts/researcher.js</files>
  <action>
Create researcher.js that performs automated research using web searches and integrates with existing research-synthesizer.js.

The script must export 3 functions:

**1. performResearch(topic, type, options = {})**
- Parameters:
  - topic: string (e.g., "React ecosystem", "Node.js authentication")
  - type: string ('STACK', 'FEATURES', 'ARCHITECTURE', 'PITFALLS', or 'CUSTOM')
  - options: object {maxSearches: 5, includeOfficialDocs: true, targetSources: []}
- Logic:
  - Generate 3-5 search queries based on topic and type
  - For STACK: "${topic} official documentation", "${topic} getting started", "${topic} best practices"
  - For FEATURES: "${topic} features", "${topic} capabilities", "${topic} use cases"
  - For ARCHITECTURE: "${topic} architecture patterns", "${topic} design patterns", "${topic} project structure"
  - For PITFALLS: "${topic} common mistakes", "${topic} pitfalls", "${topic} anti-patterns"
  - Perform web searches (simulate with console.log for now - will use WebSearch in production)
  - Extract findings from search results
  - Return array of {title, content, source} objects
- Returns: Promise<Array<{title: string, content: string, source: string}>>
- Async function

**2. extractFindings(searchResults)**
- Parameters: searchResults (array of search result objects)
- Logic:
  - Parse search results
  - Extract: title (from result title), content (from snippet/description), source (URL)
  - Filter out low-quality sources (exclude forums, exclude sites without HTTPS)
  - Deduplicate by URL
  - Return structured findings
- Returns: Array<{title: string, content: string, source: string}>
- Sync function

**3. mergeManualFindings(automatedFindings, manualFindings)**
- Parameters:
  - automatedFindings: array from performResearch()
  - manualFindings: array of {title, content, source, verifiedWithOfficial?: boolean}
- Logic:
  - Combine both arrays
  - Preserve verifiedWithOfficial flag from manual findings
  - Deduplicate by source URL (manual takes precedence)
  - Sort by confidence level (HIGH first, then MEDIUM, then LOW)
- Returns: Array<{title: string, content: string, source: string, verifiedWithOfficial?: boolean}>
- Sync function

**Implementation details:**
- Import { assignConfidenceLevel } from './research-synthesizer.js'
- For now, performResearch() should return mock data (simulate web search)
- Add TODO comment: "// TODO: Integrate with WebSearch tool when available in Tabnine"
- Mock data structure:
  ```javascript
  const mockFindings = [
    {
      title: 'Official Documentation',
      content: 'Getting started guide...',
      source: 'https://docs.example.com/getting-started'
    },
    {
      title: 'Community Guide',
      content: 'Best practices...',
      source: 'https://blog.example.com/guide'
    }
  ];
  ```
- Use async/await patterns (Phase 2 convention)
- Error handling: throw descriptive errors if topic or type invalid
- Query construction based on research type
- Deduplicate using Set or Map keyed by source URL

Follow Phase 2 patterns: ESM modules, async/await, no Sync operations.
  </action>
  <verify>
Check file exists and exports:
- ls gsd/scripts/researcher.js
- grep "export function performResearch" gsd/scripts/researcher.js
- grep "export function extractFindings" gsd/scripts/researcher.js
- grep "export function mergeManualFindings" gsd/scripts/researcher.js

Verify imports:
- grep "import.*research-synthesizer" gsd/scripts/researcher.js

Verify async patterns:
- grep "async function performResearch" gsd/scripts/researcher.js

Verify no synchronous operations:
- grep "Sync" gsd/scripts/researcher.js (should find nothing except in comments)
  </verify>
  <done>
researcher.js exists with performResearch (web search simulation), extractFindings (parse results), and mergeManualFindings (combine automated + manual). Script uses mock data for now with TODO for WebSearch integration, follows async/await patterns, and imports from research-synthesizer.js.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Test Suite 11 for automated research</name>
  <files>gsd/scripts/integration-test.js</files>
  <action>
Add Test Suite 11 to integration-test.js following the pattern from existing Test Suites 1-10.

Test Suite 11 must include 6 tests:

**Automated Research Tests (6 tests):**

1. **Test: performResearch generates findings for STACK type**
   - Import { performResearch } from './researcher.js'
   - Call performResearch('React', 'STACK')
   - Assert result is array
   - Assert result.length > 0
   - Assert first finding has title, content, source properties
   - Assert source is valid URL (starts with https://)

2. **Test: performResearch generates findings for FEATURES type**
   - Call performResearch('React', 'FEATURES')
   - Assert result includes findings
   - Assert findings differ from STACK type (different queries)

3. **Test: performResearch generates findings for ARCHITECTURE type**
   - Call performResearch('Node.js', 'ARCHITECTURE')
   - Assert result includes findings
   - Assert at least one finding mentions architecture/patterns

4. **Test: extractFindings parses search results correctly**
   - Import { extractFindings } from './researcher.js'
   - Create mock search results: [{title: 'Test', snippet: 'Content', url: 'https://example.com'}]
   - Call extractFindings(mockResults)
   - Assert result has correct structure
   - Assert HTTPS sources included, HTTP excluded

5. **Test: mergeManualFindings combines automated + manual**
   - Import { mergeManualFindings } from './researcher.js'
   - Create automated findings: [{title: 'Auto', content: 'Content', source: 'https://auto.com'}]
   - Create manual findings: [{title: 'Manual', content: 'Content', source: 'https://manual.com', verifiedWithOfficial: true}]
   - Call mergeManualFindings(automated, manual)
   - Assert result.length === 2
   - Assert manual finding preserves verifiedWithOfficial flag

6. **Test: mergeManualFindings deduplicates by source URL**
   - Create automated findings: [{title: 'Auto', content: 'Old content', source: 'https://example.com'}]
   - Create manual findings: [{title: 'Manual', content: 'New content', source: 'https://example.com'}]
   - Call mergeManualFindings(automated, manual)
   - Assert result.length === 1 (deduplicated)
   - Assert result[0].content === 'New content' (manual takes precedence)

**Test execution pattern:**
- Follow existing test suite structure (console group, try/catch)
- Accumulate failures in testResults array
- Report pass/fail counts at end
- All tests should pass (use mock data, no actual web searches)

**Update test summary:**
- Increment total test count (51 existing + 6 new = 57 total)
- Add Test Suite 11 to summary output
- Update success rate calculation
  </action>
  <verify>
Run integration tests:
- node gsd/scripts/integration-test.js

Expected output:
- "Test Suite 11: Automated Research" appears
- 6 new tests listed
- Total tests: 57 (51 existing + 6 new)
- All tests pass (57/57)

Check test additions:
- grep "Test Suite 11" gsd/scripts/integration-test.js
- grep "performResearch generates findings for STACK type" gsd/scripts/integration-test.js
- grep "mergeManualFindings deduplicates" gsd/scripts/integration-test.js
  </verify>
  <done>
integration-test.js includes Test Suite 11 with 6 tests covering performResearch (STACK/FEATURES/ARCHITECTURE types), extractFindings (parsing), and mergeManualFindings (combine + deduplicate). All 57 integration tests pass (51 existing + 6 new). Test suite validates automated research functionality end-to-end.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. **Research guideline validation:**
   - research.md follows AGENTS.md six-section structure
   - Includes step-by-step process for automated and manual research
   - Success criteria and artifacts defined
   - Integration points documented

2. **Researcher module validation:**
   - researcher.js exports 3 functions (performResearch, extractFindings, mergeManualFindings)
   - Mock data for web searches (TODO for WebSearch integration)
   - Follows async/await patterns
   - Integrates with research-synthesizer.js

3. **Integration test validation:**
   - Test Suite 11 exists with 6 tests
   - Tests cover all researcher.js functions
   - All 57 tests pass (100% pass rate)

Run verification commands:
```bash
# Guideline structure
grep "## " gsd/guidelines/research.md | wc -l
# Should output: 6 (six sections)

# Researcher exports
grep "export function" gsd/scripts/researcher.js | wc -l
# Should output: 3

# Integration tests
node gsd/scripts/integration-test.js
# Should show: 57/57 tests passed (100%)
```
</verification>

<success_criteria>
1. research.md exists with AGENTS.md six-section structure and research workflow
2. researcher.js exists with 3 exported functions (performResearch, extractFindings, mergeManualFindings)
3. Mock data used for web searches with TODO for WebSearch integration
4. Integration tests include Test Suite 11 with 6 new tests (automated research)
5. All 57 integration tests pass (51 existing + 6 new = 100% pass rate)
6. Automated research integrates with existing research-synthesizer.js
7. Both automated and manual research workflows supported
8. All file operations use async/await patterns (Phase 2 convention)
</success_criteria>

<output>
After completion, create `.planning/phases/04-advanced-features/04-03-SUMMARY.md` with:
- Files created (research.md, researcher.js) and modified (integration-test.js)
- Exports from researcher.js (3 functions)
- Test results (57/57 tests passed)
- Gap filled: Automated research capability added to Phase 4
- Integration points: How automated research feeds into research-synthesizer.js
- TODO: WebSearch integration when available in Tabnine
</output>
