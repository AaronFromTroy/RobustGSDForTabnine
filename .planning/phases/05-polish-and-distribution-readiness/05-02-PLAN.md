---
phase: 05-polish-and-distribution-readiness
plan: 02
type: execute
wave: 2
depends_on: [05-01]
files_modified:
  - .releaserc.json
  - .github/workflows/release.yml
  - .github/workflows/ci.yml
  - gsd/package.json
autonomous: false

user_setup:
  - service: npm
    why: "Publish packages to npm registry"
    env_vars: []
    dashboard_config:
      - task: "Configure trusted publishing for GitHub Actions"
        location: "npmjs.com → Account → Access Tokens → Trusted Publishers → Add GitHub Actions"
        instructions: "Repository: yourusername/gsd-for-tabnine, Workflow: release.yml, Environment: none"
      - task: "Update repository URL in package.json"
        location: "Local: gsd/package.json"
        instructions: "Replace 'yourusername' with actual GitHub username in repository, bugs, homepage fields"

must_haves:
  truths:
    - "Commits to main branch trigger automated release process"
    - "semantic-release analyzes commits and determines version bump"
    - "CHANGELOG.md is auto-generated from conventional commits"
    - "Package is published to npm without manual intervention"
    - "CI tests pass before any release"
  artifacts:
    - path: ".releaserc.json"
      provides: "semantic-release configuration"
      contains: ["@semantic-release/changelog", "@semantic-release/npm", "@semantic-release/git"]
    - path: ".github/workflows/release.yml"
      provides: "GitHub Actions release workflow"
      contains: ["semantic-release", "id-token: write", "GITHUB_TOKEN"]
    - path: ".github/workflows/ci.yml"
      provides: "CI test workflow"
      contains: ["npm test", "matrix"]
    - path: "gsd/package.json"
      provides: "semantic-release dependencies"
      exports: []
  key_links:
    - from: ".github/workflows/release.yml"
      to: ".releaserc.json"
      via: "npx semantic-release reads config"
      pattern: "npx semantic-release"
    - from: ".releaserc.json"
      to: "gsd/package.json"
      via: "@semantic-release/npm plugin"
      pattern: "@semantic-release/npm"
---

<objective>
Automate release process with semantic versioning, changelog generation, and npm publishing via GitHub Actions with trusted publishing.

Purpose: Eliminate manual version management, enable continuous delivery, maintain changelog automatically from conventional commits, and publish securely without long-lived tokens.

Output: Configured semantic-release, GitHub Actions workflows for CI and release, ready for automated publishing.
</objective>

<execution_context>
@~/.claude/get-stuff-done/workflows/execute-plan.md
@~/.claude/get-stuff-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-polish-and-distribution-readiness/05-RESEARCH.md
@.planning/phases/05-polish-and-distribution-readiness/05-01-SUMMARY.md

# Updated package.json from Plan 1
@gsd/package.json
</context>

<tasks>

<task type="auto">
  <name>Install semantic-release dependencies</name>
  <files>gsd/package.json</files>
  <action>
Install semantic-release and plugins as devDependencies.

Run from gsd/ directory:
```bash
cd gsd
npm install --save-dev semantic-release @semantic-release/changelog @semantic-release/git @semantic-release/npm
```

Packages:
- semantic-release: Core automation engine
- @semantic-release/changelog: Generates CHANGELOG.md from commits
- @semantic-release/git: Commits updated package.json and CHANGELOG.md back to repo
- @semantic-release/npm: Publishes to npm registry

These enable fully automated release workflow: analyze commits → determine version → update changelog → publish to npm → create GitHub release.

Update package.json scripts section:
- Add "semantic-release": "semantic-release" (for manual testing)

Do NOT run semantic-release yet - that happens in GitHub Actions after user configures trusted publishing.
  </action>
  <verify>cd gsd && npm list semantic-release @semantic-release/changelog @semantic-release/git @semantic-release/npm</verify>
  <done>semantic-release and plugins installed in devDependencies, package.json has semantic-release script</done>
</task>

<task type="auto">
  <name>Create semantic-release configuration</name>
  <files>.releaserc.json</files>
  <action>
Create .releaserc.json at project root (NOT in gsd/ directory) with semantic-release configuration.

Configuration:
```json
{
  "branches": ["main"],
  "plugins": [
    "@semantic-release/commit-analyzer",
    "@semantic-release/release-notes-generator",
    [
      "@semantic-release/changelog",
      {
        "changelogFile": "gsd/CHANGELOG.md"
      }
    ],
    [
      "@semantic-release/npm",
      {
        "pkgRoot": "gsd"
      }
    ],
    [
      "@semantic-release/git",
      {
        "assets": ["gsd/package.json", "gsd/package-lock.json", "gsd/CHANGELOG.md"],
        "message": "chore(release): ${nextRelease.version} [skip ci]\n\n${nextRelease.notes}"
      }
    ],
    "@semantic-release/github"
  ]
}
```

Why project root: GitHub Actions runs at project root, needs to find config and access gsd/ subdirectory.

Why pkgRoot: Tells semantic-release that package.json is in gsd/ subdirectory, not project root.

Plugin order matters:
1. commit-analyzer: Reads commits, determines version bump
2. release-notes-generator: Creates release notes
3. changelog: Writes CHANGELOG.md
4. npm: Publishes to npm
5. git: Commits updated files back
6. github: Creates GitHub release

[skip ci] prevents infinite loop of release commits triggering new releases.
  </action>
  <verify>cat .releaserc.json | grep '"pkgRoot": "gsd"' && cat .releaserc.json | grep "@semantic-release/changelog"</verify>
  <done>.releaserc.json exists with semantic-release configuration pointing to gsd/ subdirectory</done>
</task>

<task type="auto">
  <name>Create GitHub Actions CI workflow</name>
  <files>.github/workflows/ci.yml</files>
  <action>
Create .github/workflows/ci.yml for continuous integration testing.

Workflow triggers on:
- Push to any branch (not just main)
- Pull requests to main

Matrix strategy: Test on multiple platforms and Node versions
- OS: ubuntu-latest, windows-latest, macos-latest
- Node: 24.x (current LTS requirement)

Steps:
1. Checkout code (fetch-depth: 0 not needed for CI, only release)
2. Setup Node.js 24.x
3. Install dependencies: `cd gsd && npm ci`
4. Run tests: `cd gsd && npm test`

Example structure:
```yaml
name: CI

on:
  push:
    branches: ['**']
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        node-version: [24.x]

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}

      - name: Install dependencies
        run: |
          cd gsd
          npm ci

      - name: Run tests
        run: |
          cd gsd
          npm test
```

Why matrix: Validates cross-platform compatibility (Windows path handling, Unix permissions, macOS quirks).

Why npm ci: Faster and stricter than npm install, uses package-lock.json exactly.
  </action>
  <verify>cat .github/workflows/ci.yml | grep "matrix:" && cat .github/workflows/ci.yml | grep "windows-latest"</verify>
  <done>.github/workflows/ci.yml runs tests on Windows/Linux/macOS with Node 24</done>
</task>

<task type="auto">
  <name>Create GitHub Actions release workflow</name>
  <files>.github/workflows/release.yml</files>
  <action>
Create .github/workflows/release.yml for automated releases with trusted publishing.

Workflow triggers ONLY on push to main branch (releases from main only).

CRITICAL: Must include `permissions.id-token: write` for OIDC trusted publishing.

Steps:
1. Checkout with full git history (semantic-release needs commit history)
2. Setup Node.js 24.x
3. Install dependencies: `cd gsd && npm ci`
4. Run tests: `cd gsd && npm test` (safety gate before release)
5. Run semantic-release (reads .releaserc.json, analyzes commits, publishes)

Example structure:
```yaml
name: Release

on:
  push:
    branches:
      - main

permissions:
  contents: write      # semantic-release pushes commits and tags
  issues: write        # semantic-release comments on issues
  pull-requests: write # semantic-release comments on PRs
  id-token: write      # CRITICAL: OIDC trusted publishing to npm

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for semantic-release

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 24

      - name: Install dependencies
        run: |
          cd gsd
          npm ci

      - name: Run tests
        run: |
          cd gsd
          npm test

      - name: Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: npx semantic-release
```

NO NPM_TOKEN in env - trusted publishing uses OIDC (id-token permission).

Why fetch-depth: 0: semantic-release analyzes entire commit history to determine version and generate changelog.

Why run tests before release: Prevents publishing broken code. If tests fail, release stops.
  </action>
  <verify>cat .github/workflows/release.yml | grep "id-token: write" && cat .github/workflows/release.yml | grep "fetch-depth: 0"</verify>
  <done>.github/workflows/release.yml configured for semantic-release with OIDC trusted publishing</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Configure npm trusted publishing for GitHub Actions</action>
  <why>
Trusted publishing requires account-level configuration on npmjs.com. Claude cannot:
1. Log in to npm account
2. Access npm account settings
3. Configure publisher trust relationships

This is genuinely manual - no API or CLI exists for trusted publisher setup.
  </why>
  <instructions>
**Required: npm account and package claim**

1. **Create npm account (if not exists):**
   - Visit https://www.npmjs.com/signup
   - Create account with email verification

2. **Claim package name:**
   - Visit https://www.npmjs.com/package/gsd-for-tabnine
   - If available, package will be claimable on first publish
   - If taken, choose different name and update gsd/package.json

3. **Configure trusted publishing:**
   - Visit https://www.npmjs.com/settings/yourusername/tokens
   - Click "Trusted Publishers" tab
   - Click "Add Trusted Publisher"
   - Select "GitHub Actions"
   - Enter:
     - Repository: `yourusername/gsd-for-tabnine` (replace yourusername)
     - Workflow: `release.yml`
     - Environment: leave blank (none)
   - Save

4. **Update repository URLs in package.json:**
   - Open gsd/package.json
   - Find "repository", "bugs", "homepage" fields
   - Replace `yourusername` with your actual GitHub username
   - Save file
   - Commit: `git add gsd/package.json && git commit -m "chore: update repository URLs"`

5. **Verify npm CLI version:**
   - Run: `npm --version`
   - Must be >= 11.5.1 for trusted publishing
   - If older: `npm install -g npm@latest`

**When complete:** Type "npm trusted publishing configured" to continue.

**How to verify:**
- Trusted publisher should appear in npm settings
- First release workflow run will use OIDC to publish (no token needed)
  </instructions>
  <resume-signal>Type "npm trusted publishing configured" when setup complete</resume-signal>
</task>

</tasks>

<verification>
1. Validate semantic-release config:
   - `cat .releaserc.json | grep pkgRoot` shows "gsd"
   - All plugins listed in correct order
2. Validate GitHub Actions syntax:
   - `cat .github/workflows/ci.yml | grep "runs-on:"` shows matrix
   - `cat .github/workflows/release.yml | grep "id-token: write"` confirms OIDC
3. Test semantic-release dry-run (after user setup):
   - `npx semantic-release --dry-run` (from project root)
   - Should analyze commits and show what would happen (no actual publish in dry-run)
4. Verify package.json repository URL updated:
   - No "yourusername" placeholders remaining
</verification>

<success_criteria>
- semantic-release and plugins installed in devDependencies
- .releaserc.json configures semantic-release for gsd/ subdirectory
- CI workflow tests on Windows/Linux/macOS
- Release workflow has OIDC permissions (id-token: write)
- User has configured npm trusted publishing
- Repository URLs in package.json point to actual repo (no placeholders)
- Dry-run of semantic-release succeeds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-polish-and-distribution-readiness/05-02-SUMMARY.md`
</output>
