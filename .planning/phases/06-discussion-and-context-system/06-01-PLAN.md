---
phase: 06-discussion-and-context-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [gsd/templates/CONTEXT.md, gsd/scripts/question-bank.js]
autonomous: true

must_haves:
  truths:
    - "CONTEXT.md template exists with MADR-style structure (frontmatter + categorized sections)"
    - "Question taxonomy adapts to phase type (technical, design, workflow)"
    - "Questions are progressive (essential → follow-up → clarification)"
  artifacts:
    - path: "gsd/templates/CONTEXT.md"
      provides: "Structured discussion result storage"
      min_lines: 80
      contains: "frontmatter with phase/status, <decisions> section, <deferred> section"
    - path: "gsd/scripts/question-bank.js"
      provides: "Adaptive question taxonomy"
      exports: ["QUESTION_TAXONOMY", "detectPhaseType", "getQuestionsForPhase"]
      min_lines: 150
  key_links:
    - from: "gsd/scripts/question-bank.js"
      to: "gsd/guidelines/plan-phase.md"
      via: "Guideline references question taxonomy"
      pattern: "question-bank.js"
---

<objective>
Create structured templates and adaptive question taxonomy to formalize the discussion system.

**Purpose:** Provide the foundation for consistent, structured context gathering before planning. Builds on existing plan-phase.md discussion questions (v1.1.0) by formalizing structure and enabling phase-type adaptation.

**Output:** CONTEXT.md template with MADR-inspired structure and question-bank.js with taxonomy for technical/design/workflow phases.
</objective>

<execution_context>
@gsd/guidelines/execute-phase.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-discussion-and-context-system/06-RESEARCH.md

# Existing patterns
@.planning/phases/04-advanced-features/04-01-SUMMARY.md
@gsd/templates/PLAN.md
@gsd/guidelines/plan-phase.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CONTEXT.md template with MADR-style structure</name>
  <files>gsd/templates/CONTEXT.md</files>
  <action>
Create gsd/templates/CONTEXT.md following the MADR pattern from research:

**Frontmatter (YAML):**
- version: "1.0.0"
- type: "template"
- artifact: "CONTEXT"
- schema: "gsd-context-v1"
- variables: [phase, phase_name, gathered, status, discussion_type, phase_boundary, locked_decisions, discretion_items, deferred_items]

**Template structure:**
```markdown
---
phase: ${phase}
phase_name: "${phase_name}"
gathered: "${gathered}"
status: "${status}"
discussion_type: "${discussion_type}"
---

# Phase ${phase}: ${phase_name} - Context

**Gathered:** ${gathered}
**Status:** ${status}

<domain>
## Phase Boundary

${phase_boundary}

</domain>

<decisions>
## Implementation Decisions

User's locked-in choices that constrain research and planning.

### Technology & Architecture

${locked_decisions}

### Claude's Discretion

Areas where Claude has freedom to choose:

${discretion_items}

</decisions>

<specifics>
## Specific Ideas

Implementation details and preferences gathered from discussion.

${specifics_content}

</specifics>

<deferred>
## Deferred Ideas

Ideas explicitly marked as out-of-scope for this phase.

${deferred_items}

</deferred>

---

*Phase: ${phase_name}*
*Context gathered: ${gathered}*
```

Follow existing template patterns (see @gsd/templates/PLAN.md for reference).
Use template literal syntax (`${var}`) compatible with template-renderer.js from Phase 2.
Include XML-style tags (`<decisions>`, `<deferred>`) for machine parsing.
  </action>
  <verify>
1. File exists: gsd/templates/CONTEXT.md
2. Contains YAML frontmatter with version and variables array
3. Contains all required sections: domain, decisions, specifics, deferred
4. Uses ${var} template literal syntax
5. Structure matches MADR pattern from research (frontmatter + sections)
  </verify>
  <done>CONTEXT.md template ready for template-renderer.js usage</done>
</task>

<task type="auto">
  <name>Task 2: Create question-bank.js with adaptive taxonomy</name>
  <files>gsd/scripts/question-bank.js</files>
  <action>
Create gsd/scripts/question-bank.js following patterns from existing scripts (@gsd/scripts/research-synthesizer.js):

**Export 3 functions:**

1. **QUESTION_TAXONOMY constant** (exported object):
   ```javascript
   export const QUESTION_TAXONOMY = {
     technical: {
       essential: [
         "What technology stack do you prefer for {component}?",
         "Any existing libraries or frameworks you want to use?",
         "Code organization preference (flat, modular, domain-driven)?",
         "Testing strategy (unit, integration, e2e)?"
       ],
       followUp: {
         // Conditional questions based on essential answers
       }
     },
     design: {
       essential: [
         "Do you have a design system or style guide to follow?",
         "Preferred UI framework/library (React, Vue, vanilla, etc.)?",
         "Responsive design requirements (mobile-first, desktop-first)?",
         "Accessibility requirements (WCAG level, screen reader support)?",
         "Component library to use (MUI, Ant Design, Tailwind, custom)?"
       ],
       followUp: {}
     },
     workflow: {
       essential: [
         "What's your risk tolerance? (move fast vs be cautious)",
         "Preferred commit granularity? (atomic vs feature branches)",
         "Are there any constraints I should know about?"
       ],
       followUp: {}
       }
   };
   ```

2. **detectPhaseType(phaseGoal)**: Returns { technical, design, workflow } booleans
   - Parse phaseGoal string for keywords
   - UI/frontend/dashboard/component → design: true
   - API/backend/infrastructure/database → technical: true, design: false
   - Workflow/orchestration/automation → workflow: true
   - Default: { technical: true, design: false, workflow: true }

3. **getQuestionsForPhase(phaseGoal)**: Returns array of question objects
   - Calls detectPhaseType(phaseGoal)
   - Combines relevant question categories
   - Returns structured: { category, questions }

**Implementation notes:**
- Use ESM import/export (all existing scripts use ESM)
- Draw questions from plan-phase.md v1.1.0 existing question banks
- Structure for progressive questioning (essential first, follow-ups conditional)
- Include JSDoc comments for function signatures
- Validate phaseGoal is string, handle empty/null gracefully
  </action>
  <verify>
1. File exists: gsd/scripts/question-bank.js
2. Exports QUESTION_TAXONOMY constant with technical/design/workflow sections
3. Exports detectPhaseType function that returns boolean object
4. Exports getQuestionsForPhase function that returns question array
5. ESM syntax (import/export, not require)
6. JSDoc comments present
7. Test manually:
   ```javascript
   import { detectPhaseType, getQuestionsForPhase } from './gsd/scripts/question-bank.js';
   console.log(detectPhaseType('Build dashboard UI'));
   // Should return: { technical: true, design: true, workflow: true }
   console.log(getQuestionsForPhase('API infrastructure'));
   // Should return technical + workflow questions (no design)
   ```
  </verify>
  <done>question-bank.js provides adaptive question taxonomy for all phase types</done>
</task>

</tasks>

<verification>
After completing all tasks:

1. **Template validation:**
   - CONTEXT.md template has valid YAML frontmatter
   - All required sections present (domain, decisions, specifics, deferred)
   - Template literal syntax matches other templates

2. **Question taxonomy validation:**
   - detectPhaseType correctly identifies phase types from goal strings
   - getQuestionsForPhase returns appropriate questions for each phase type
   - QUESTION_TAXONOMY covers technical, design, and workflow categories

3. **Integration readiness:**
   - CONTEXT.md template compatible with template-renderer.js
   - question-bank.js follows ESM patterns from existing scripts
   - Structures ready for Plan 06-02 integration

4. **Manual test:**
   ```bash
   node -e "import('./gsd/scripts/question-bank.js').then(m => console.log(m.detectPhaseType('Dashboard UI')))"
   # Expected: { technical: true, design: true, workflow: true }
   ```
</verification>

<success_criteria>
1. gsd/templates/CONTEXT.md exists with MADR-style structure and template literal variables
2. gsd/scripts/question-bank.js exports QUESTION_TAXONOMY, detectPhaseType, and getQuestionsForPhase
3. Phase type detection works for common keywords (UI → design, API → technical)
4. Questions adapt to phase type (design questions only for UI phases)
5. All files use consistent patterns (ESM, template literals, YAML frontmatter)
6. No errors when importing question-bank.js in Node.js
</success_criteria>

<output>
After completion, create `.planning/phases/06-discussion-and-context-system/06-01-SUMMARY.md` documenting:
- CONTEXT.md template structure and sections
- Question taxonomy categories and adaptation logic
- Phase type detection keyword mapping
- Integration points for Plan 06-02
- Any deviations from plan
</output>
