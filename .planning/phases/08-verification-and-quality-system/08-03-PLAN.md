---
phase: 08-verification-and-quality-system
plan: 03
type: execute
wave: 2
depends_on: [08-01, 08-02]
files_modified:
  - gsd/scripts/verification-report.js
  - gsd/guidelines/verify-work.md
autonomous: true

must_haves:
  truths:
    - "Verification report generator creates structured markdown reports"
    - "Reports include executive summary, layer results, failed criteria, quality metrics, and next actions"
    - "verify-work.md guideline integrated with new verification modules"
    - "Guideline provides clear commands for running verification"
  artifacts:
    - path: "gsd/scripts/verification-report.js"
      provides: "Report generation from verification results"
      exports: ["generateVerificationReport", "saveReport"]
    - path: "gsd/guidelines/verify-work.md"
      provides: "Updated workflow with verifier.js integration"
      contains: "node gsd/scripts/verifier.js"
  key_links:
    - from: "gsd/scripts/verification-report.js"
      to: "gsd/templates/VERIFICATION.md"
      via: "renderTemplate for report generation"
      pattern: "renderTemplate.*VERIFICATION"
    - from: "gsd/guidelines/verify-work.md"
      to: "gsd/scripts/verifier.js"
      via: "workflow commands"
      pattern: "verifier\\.js.*--phase"
---

<objective>
Create verification report generator and integrate with verify-work guideline.

Purpose: Complete the verification system by generating human-readable VERIFICATION.md reports from verification results and updating verify-work.md guideline to use the new multi-layer verification modules (verifier.js, goal-validator.js, quality-checker.js) instead of just validator.js.

Output: verification-report.js for report generation and updated verify-work.md guideline with simplified commands that invoke the new verification orchestrator.
</objective>

<execution_context>
@C:/Users/acous/OneDrive/Documents/.claude/get-stuff-done/workflows/execute-plan.md
@C:/Users/acous/OneDrive/Documents/.claude/get-stuff-done/templates/summary.md
</execution_context>

<context>
@C:/Projects/GSDForTabnine/.planning/PROJECT.md
@C:/Projects/GSDForTabnine/.planning/ROADMAP.md
@C:/Projects/GSDForTabnine/.planning/STATE.md
@C:/Projects/GSDForTabnine/.planning/phases/08-verification-and-quality-system/08-RESEARCH.md
@C:/Projects/GSDForTabnine/gsd/guidelines/verify-work.md
@C:/Projects/GSDForTabnine/gsd/scripts/template-renderer.js
@C:/Projects/GSDForTabnine/.planning/phases/08-verification-and-quality-system/08-01-PLAN.md
@C:/Projects/GSDForTabnine/.planning/phases/08-verification-and-quality-system/08-02-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create verification-report.js module</name>
  <files>gsd/scripts/verification-report.js</files>
  <action>
    Create verification-report.js module for report generation (research lines 209-244).

    Exports (2 functions, 200-250 lines total):

    1. generateVerificationReport(results):
       - Accepts results object from verifier.js: { phase, passed, layers, failures, duration }
       - Transforms into template variables for VERIFICATION.md
       - Returns variables object for template rendering
       - Structure matches VERIFICATION.md template variables:
         ```javascript
         {
           phase: results.phase,
           verified: new Date().toISOString(),
           timestamp: new Date().toISOString(),
           passed: results.passed,
           failures_count: results.failures.length,
           duration: results.duration,

           // Layer results
           layers_smoke_passed: results.layers.smoke?.passed || false,
           layers_smoke_duration: results.layers.smoke?.duration || '0s',
           layers_linting_passed: results.layers.linting?.passed || false,
           layers_linting_errors: results.layers.linting?.errors || 0,
           layers_linting_warnings: results.layers.linting?.warnings || 0,
           layers_unit_passed: results.layers.unitTests?.passed || false,
           layers_unit_count: results.layers.unitTests?.count || 0,
           layers_unit_coverage: results.layers.unitTests?.coverage || 0,
           layers_integration_passed: results.layers.integration?.passed || false,
           layers_integration_count: results.layers.integration?.count || 0,
           layers_acceptance_total: results.layers.acceptance?.length || 0,
           layers_acceptance_passed: results.layers.acceptance?.filter(c => c.passed).length || 0,

           // Failures (join with newline for template)
           failures: results.failures.map((f, i) => `${i+1}. ${f}`).join('\n'),

           // Quality metrics (extract from layer results)
           coverage_lines: results.layers.unitTests?.coverage || 0,
           coverage_branches: 0, // not tracked yet
           coverage_functions: 0, // not tracked yet
           complexity_avg: 0, // not tracked yet
           complexity_max: 0, // not tracked yet
           tests_total: results.layers.unitTests?.count || 0,
           tests_passed: results.layers.unitTests?.count || 0,
           tests_failed: results.layers.unitTests?.failures || 0,

           // Next action
           next_action: results.passed
             ? 'Phase verified. Proceed to next phase.'
             : `Fix ${results.failures.length} issue(s) before proceeding.`
         }
         ```
       - Handle missing layers gracefully: use || 0 or || false defaults
       - Format failures as numbered list for readability

    2. saveReport(phaseNumber, results, outputPath = null):
       - Generates report using generateVerificationReport(results)
       - Renders VERIFICATION.md template using template-renderer.js
       - Determines output path: outputPath || `.planning/phases/0${phaseNumber}-*/VERIFICATION.md`
       - Writes to file using file-ops.js writeFileAtomic
       - Returns { path, success: true }
       - Error handling: if template rendering fails, return { path, success: false, error }

    Import patterns:
    - renderTemplate from './template-renderer.js'
    - writeFileAtomic from './file-ops.js'
    - path from 'node:path'
    - fs from 'node:fs/promises' (for finding phase directory)

    Helper function (internal):
    - findPhaseDirectory(phaseNumber): searches .planning/phases/ for matching directory (0N-* or NN-*)
    - Returns directory name or throws if not found

    Follow existing patterns:
    - JSDoc comments for all exported functions
    - Clear parameter types and return values
    - Graceful error handling with informative messages
  </action>
  <verify>
    1. Module exports 2 functions: generateVerificationReport, saveReport
    2. generateVerificationReport transforms verification results to template variables
    3. saveReport renders VERIFICATION.md and writes to phase directory
    4. All template variables match VERIFICATION.md template structure
    5. Failures formatted as numbered list
    6. Missing layer data handled gracefully (defaults to 0/false)
    7. Code follows ESM syntax (import/export)
    8. All functions have JSDoc comments
    9. No syntax errors (can be imported without throwing)
  </verify>
  <done>
    verification-report.js module exists and can generate VERIFICATION.md reports from verification results. Module integrates with template-renderer.js to populate VERIFICATION.md template and saves reports to phase directories. Completes the verification system's reporting layer.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update verify-work.md guideline</name>
  <files>gsd/guidelines/verify-work.md</files>
  <action>
    Update verify-work.md guideline to integrate new verification modules (verifier.js, goal-validator.js, quality-checker.js).

    Changes to make:

    1. Update "Commands" section (lines 13-42):
       Replace complex multi-command sequence with simplified orchestrator invocation:
       ```bash
       # Run comprehensive verification (all 5 layers)
       node gsd/scripts/verifier.js --phase=${PHASE_NUM}

       # If verification failed, generate report
       node gsd/scripts/verification-report.js --phase=${PHASE_NUM} --results="${RESULTS_JSON}"

       # Update STATE.md
       node gsd/scripts/state-manager.js --update verification="${RESULT}" verifiedDate="${DATE}"

       # Create git commit (if verification passed)
       git add .planning/STATE.md .planning/phases/${PHASE_DIR}/VERIFICATION.md
       git commit -m "docs(phase-${PHASE_NUM}): verification ${RESULT}

       - Smoke tests: ${SMOKE_RESULT}
       - Linting: ${LINT_RESULT} (${ERROR_COUNT} errors, ${WARNING_COUNT} warnings)
       - Unit tests: ${UNIT_RESULT} (${TEST_COUNT} tests, ${COVERAGE}% coverage)
       - Integration tests: ${INTEGRATION_RESULT}
       - Acceptance criteria: ${ACCEPTANCE_RESULT} (${CRITERIA_MET}/${CRITERIA_TOTAL})

       Co-Authored-By: Tabnine Agent <noreply@tabnine.com>"
       ```

    2. Update "Testing" section (lines 44-52):
       Add verification layer checks:
       ```
       1. Smoke tests pass (STATE.md valid, phase directory exists, required artifacts exist)
       2. Linting has no errors (warnings allowed)
       3. Unit tests pass with coverage ≥ 80%
       4. Integration tests pass (all test suites)
       5. Acceptance criteria validated (all success criteria from ROADMAP.md met)
       6. STATE.md shows verification status (passed or issues documented)
       7. If issues found, VERIFICATION.md exists with remediation guidance
       ```

    3. Update "Workflow Steps" section (lines 134-179):
       Simplify to reflect new orchestrator:
       ```
       1. **Run multi-layer verification:**
          - Execute verifier.js with phase number
          - verifier.js orchestrates all 5 layers:
            a. Smoke tests (critical file checks)
            b. Static analysis (linting)
            c. Unit tests with coverage (integration-test.js)
            d. Integration tests (integration-test.js)
            e. Acceptance criteria (goal-validator.js)
          - Returns comprehensive results object

       2. **Generate report if failed:**
          - If verification passed: skip report generation
          - If verification failed:
            a. Execute verification-report.js
            b. Generates VERIFICATION.md using template
            c. Saves to phase directory

       3. **Update STATE.md:**
          - Execute state-manager.js with verification result
          - If passed: verification="passed", verifiedDate="${DATE}"
          - If failed: verification="failed", include issue summary

       4. **Report results:**
          - If passed: "Phase ${PHASE_NUM} verification passed. All ${LAYERS_COUNT} layers complete."
          - If failed: "Phase ${PHASE_NUM} verification failed. See VERIFICATION.md for ${ISSUE_COUNT} issue(s)."
       ```

    4. Add new section after "Workflow Steps" (before "Success Criteria"):
       ```markdown
       ## Verification Layers

       The verification system uses 5 layers executed in sequence:

       **Layer 1: Smoke Tests (10 seconds)**
       - Critical file existence (STATE.md, phase directory, PROJECT.md, ROADMAP.md, REQUIREMENTS.md)
       - Fail-fast: if smoke tests fail, verification stops immediately

       **Layer 2: Static Analysis (20 seconds)**
       - ESLint code quality checks
       - Fail-fast: if linting errors found, verification stops (warnings allowed)

       **Layer 3: Unit Tests (1-2 minutes)**
       - Execute integration-test.js for all test suites
       - Check coverage threshold (80% default, configurable)
       - Continue even if coverage below threshold (accumulates failure)

       **Layer 4: Integration Tests (2-3 minutes)**
       - Execute integration-test.js end-to-end workflows
       - Validate component interactions
       - Continue even if tests fail (accumulates failure)

       **Layer 5: Acceptance Criteria (1 minute)**
       - Validate success criteria from ROADMAP.md
       - Check deliverables, requirements coverage, phase goals
       - Continue to complete all criteria checks (accumulates failures)

       **Total duration:** 4-6 minutes for complete verification
       ```

    5. Update "Success Criteria" section (lines 180-190):
       Replace with multi-layer success criteria:
       ```
       1. Smoke tests passed (all critical files exist and are valid)
       2. Linting passed (no errors, warnings acceptable)
       3. Unit tests passed with coverage ≥ 80%
       4. Integration tests passed (all test suites)
       5. Acceptance criteria validated (all success criteria from ROADMAP.md met)
       6. STATE.md shows verification result (passed or failed with issue count)
       7. If failed, VERIFICATION.md exists with layer-by-layer results and remediation
       8. Git commit created (only if verification passed)
       ```

    Preserve existing sections that don't need changes:
    - Project Structure (lines 54-66)
    - Code Style (lines 68-82)
    - Git Workflow (lines 84-110)
    - Boundaries (lines 112-132)
    - Validation Examples (lines 191-215)
    - Error Messages and Remediation (lines 217-238)
    - Next Action (lines 240-249)

    Maintain document structure:
    - Keep YAML frontmatter unchanged
    - Keep markdown formatting consistent
    - Keep code block syntax highlighting
    - Keep existing examples that demonstrate patterns
  </action>
  <verify>
    1. Commands section updated to use verifier.js orchestrator
    2. Testing section lists all 5 verification layers
    3. Workflow Steps simplified to reflect orchestrator pattern
    4. New "Verification Layers" section added explaining 5-layer architecture
    5. Success Criteria updated to include all layers
    6. Existing sections preserved (Project Structure, Code Style, Git Workflow, Boundaries)
    7. Document maintains valid markdown structure
    8. YAML frontmatter unchanged
  </verify>
  <done>
    verify-work.md guideline updated to integrate new verification modules. Guideline now provides simplified commands for running multi-layer verification via verifier.js orchestrator, clear documentation of 5 verification layers, and comprehensive success criteria covering smoke tests through acceptance validation.
  </done>
</task>

</tasks>

<verification>
Run these checks after task completion:

1. Verification report module import:
   ```bash
   node -e "import('./gsd/scripts/verification-report.js').then(m => console.log('Exports:', Object.keys(m)))"
   ```
   Expected: Exports: generateVerificationReport, saveReport

2. Generate mock verification report:
   ```bash
   node -e "import('./gsd/scripts/verification-report.js').then(m => { const mockResults = { phase: 8, passed: false, layers: { smoke: {passed: true}, linting: {passed: true, errors: 0}, unitTests: {passed: true, count: 81, coverage: 91} }, failures: ['Test failure'], duration: 120 }; const vars = m.generateVerificationReport(mockResults); console.log('Report vars:', Object.keys(vars).length, 'variables'); })"
   ```
   Expected: Report vars: 25+ variables (all template variables populated)

3. Verify guideline updated:
   ```bash
   grep -c "verifier.js" gsd/guidelines/verify-work.md
   ```
   Expected: 2+ occurrences (in Commands and Workflow Steps sections)

4. Check verification layers documented:
   ```bash
   grep -c "Layer [1-5]:" gsd/guidelines/verify-work.md
   ```
   Expected: 5 occurrences (one for each layer in new Verification Layers section)

5. Validate markdown structure:
   ```bash
   node -e "import('fs').then(fs => fs.promises.readFile('gsd/guidelines/verify-work.md', 'utf-8')).then(content => { const lines = content.split('\n'); const hasYaml = lines[0] === '---'; const hasSections = content.includes('## Commands') && content.includes('## Verification Layers'); console.log('Valid markdown:', hasYaml && hasSections); })"
   ```
   Expected: Valid markdown: true
</verification>

<success_criteria>
1. verification-report.js exports 2 functions for report generation
2. generateVerificationReport transforms verification results to template variables
3. saveReport renders VERIFICATION.md template and writes to phase directory
4. All template variables populated (25+ variables matching VERIFICATION.md)
5. verify-work.md updated with simplified orchestrator commands
6. New "Verification Layers" section documents 5-layer architecture
7. Commands section references verifier.js as primary entry point
8. Workflow Steps simplified to reflect orchestrator pattern
9. Success Criteria updated to include all 5 layers
10. Existing sections preserved (structure, examples, boundaries)
11. Document maintains valid markdown and YAML frontmatter
12. All modules follow ESM syntax and GSD patterns
</success_criteria>

<output>
After completion, create `.planning/phases/08-verification-and-quality-system/08-03-SUMMARY.md`
</output>
