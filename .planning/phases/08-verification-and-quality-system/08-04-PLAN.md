---
phase: 08-verification-and-quality-system
plan: 04
type: execute
wave: 3
depends_on: [08-01, 08-02, 08-03]
files_modified:
  - gsd/scripts/integration-test.js
autonomous: true

must_haves:
  truths:
    - "Test Suite 15 validates verification modules (goal-validator, quality-checker, verifier)"
    - "Test Suite 16 validates report generation and guideline integration"
    - "All 95+ integration tests pass (81 existing + 14 new)"
    - "Verification modules can be imported and used without errors"
    - "End-to-end verification workflow validated"
  artifacts:
    - path: "gsd/scripts/integration-test.js"
      provides: "Test Suites 15-16 for Phase 8 verification system"
      min_lines: 1000
  key_links:
    - from: "gsd/scripts/integration-test.js"
      to: "gsd/scripts/goal-validator.js"
      via: "import and test validateAcceptanceCriteria"
      pattern: "import.*goal-validator"
    - from: "gsd/scripts/integration-test.js"
      to: "gsd/scripts/verifier.js"
      via: "import and test verifyPhase"
      pattern: "import.*verifier"
---

<objective>
Add comprehensive test coverage for Phase 8 verification system.

Purpose: Validate that all verification modules work correctly individually and together. Ensures the multi-layer verification system (goal-validator, quality-checker, verifier, verification-report) functions as designed and integrates properly with existing GSD infrastructure.

Output: Test Suites 15-16 added to integration-test.js covering all Phase 8 modules with 14 new tests, bringing total test count to 95+ tests.
</objective>

<execution_context>
@C:/Users/acous/OneDrive/Documents/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/acous/OneDrive/Documents/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:/Projects/GSDForTabnine/.planning/PROJECT.md
@C:/Projects/GSDForTabnine/.planning/ROADMAP.md
@C:/Projects/GSDForTabnine/.planning/STATE.md
@C:/Projects/GSDForTabnine/.planning/phases/08-verification-and-quality-system/08-RESEARCH.md
@C:/Projects/GSDForTabnine/gsd/scripts/integration-test.js
@C:/Projects/GSDForTabnine/.planning/phases/08-verification-and-quality-system/08-01-PLAN.md
@C:/Projects/GSDForTabnine/.planning/phases/08-verification-and-quality-system/08-02-PLAN.md
@C:/Projects/GSDForTabnine/.planning/phases/08-verification-and-quality-system/08-03-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Test Suite 15 - Verification Modules</name>
  <files>gsd/scripts/integration-test.js</files>
  <action>
    Add Test Suite 15 to integration-test.js for goal-validator, quality-checker, and verifier modules.

    Location: After Test Suite 14 (around line 900+)

    Import additions (add to top of file after existing imports):
    ```javascript
    import { validateAcceptanceCriteria, extractSuccessCriteria, createValidator } from './goal-validator.js';
    import { checkCoverageThreshold, runLinting, checkQualityGates } from './quality-checker.js';
    import { verifyPhase, runSmokeTests, runUnitTests } from './verifier.js';
    ```

    Test Suite 15 structure (8 tests):

    ```javascript
    /**
     * Test Suite 15: Verification Modules (Phase 8)
     */
    async function testVerificationModules() {
      console.log('\n=== Test Suite 15: Verification Modules (Phase 8) ===');

      // Test 1: goal-validator exports expected functions
      try {
        const hasValidate = typeof validateAcceptanceCriteria === 'function';
        const hasExtract = typeof extractSuccessCriteria === 'function';
        const hasCreate = typeof createValidator === 'function';
        logTest('goal-validator exports 3 functions', hasValidate && hasExtract && hasCreate);
      } catch (error) {
        logTest('goal-validator exports 3 functions', false, error.message);
      }

      // Test 2: extractSuccessCriteria parses ROADMAP.md
      try {
        const roadmapPath = projectPath('.planning', 'ROADMAP.md');
        const roadmapContent = await readFile(roadmapPath);
        const criteria = extractSuccessCriteria(roadmapContent, 1);
        const passed = Array.isArray(criteria) && criteria.length > 0;
        logTest('extractSuccessCriteria parses Phase 1 criteria', passed);
      } catch (error) {
        logTest('extractSuccessCriteria parses Phase 1 criteria', false, error.message);
      }

      // Test 3: validateAcceptanceCriteria returns results array
      try {
        const results = await validateAcceptanceCriteria(1);
        const passed = Array.isArray(results) && results.every(r => 'criterion' in r && 'passed' in r);
        logTest('validateAcceptanceCriteria returns structured results', passed);
      } catch (error) {
        logTest('validateAcceptanceCriteria returns structured results', false, error.message);
      }

      // Test 4: quality-checker exports expected functions
      try {
        const hasCheck = typeof checkCoverageThreshold === 'function';
        const hasLint = typeof runLinting === 'function';
        const hasGates = typeof checkQualityGates === 'function';
        logTest('quality-checker exports 3 functions', hasCheck && hasLint && hasGates);
      } catch (error) {
        logTest('quality-checker exports 3 functions', false, error.message);
      }

      // Test 5: checkCoverageThreshold validates coverage data
      try {
        const result = checkCoverageThreshold({ lines: 85, branches: 80, functions: 90 }, 80);
        const passed = typeof result.passed === 'boolean' && Array.isArray(result.failures);
        logTest('checkCoverageThreshold validates coverage', passed);
      } catch (error) {
        logTest('checkCoverageThreshold validates coverage', false, error.message);
      }

      // Test 6: verifier exports expected functions
      try {
        const hasVerify = typeof verifyPhase === 'function';
        const hasSmoke = typeof runSmokeTests === 'function';
        const hasUnit = typeof runUnitTests === 'function';
        logTest('verifier exports verification functions', hasVerify && hasSmoke && hasUnit);
      } catch (error) {
        logTest('verifier exports verification functions', false, error.message);
      }

      // Test 7: runSmokeTests checks critical files
      try {
        const result = await runSmokeTests(1);
        const passed = typeof result.passed === 'boolean' && typeof result.duration === 'string';
        logTest('runSmokeTests validates critical files', passed);
      } catch (error) {
        logTest('runSmokeTests validates critical files', false, error.message);
      }

      // Test 8: verifyPhase orchestrates all layers
      try {
        const result = await verifyPhase(1, { coverageThreshold: 80 });
        const passed = typeof result.passed === 'boolean' &&
                      typeof result.layers === 'object' &&
                      Array.isArray(result.failures);
        logTest('verifyPhase orchestrates multi-layer verification', passed);
      } catch (error) {
        logTest('verifyPhase orchestrates multi-layer verification', false, error.message);
      }
    }
    ```

    Add to main test execution (after testMultiDomainCoordination() call):
    ```javascript
    await testVerificationModules();
    ```

    Update test suite header comment (line ~10):
    ```javascript
    /**
     * Integration Test Suite for GSD Infrastructure
     * Validates all modules work together correctly
     *
     * Test coverage:
     * - Phase 2: File operations, process runner, state manager, template renderer, guideline loader, cross-platform
     * - Phase 3: Trigger detection, artifact validation, resume & orchestration
     * - Phase 4: Approval gates, research synthesis, automated research
     * - Phase 6: Discussion & context system (CONTEXT template, question taxonomy, context parsing)
     * - Phase 7: Web scraping (scraper, source-validator, deduplicator), multi-domain coordination
     * - Phase 8: Verification system (goal-validator, quality-checker, verifier)
     */
    ```
  </action>
  <verify>
    1. Test Suite 15 added after Test Suite 14
    2. 8 tests for verification modules (goal-validator: 3, quality-checker: 2, verifier: 3)
    3. Imports added for goal-validator, quality-checker, verifier
    4. testVerificationModules() called in main execution
    5. Test suite header comment updated to include Phase 8
    6. All tests follow existing logTest pattern
    7. Tests validate exports, function behavior, and return structures
    8. No syntax errors (file can be executed)
  </verify>
  <done>
    Test Suite 15 added to integration-test.js with 8 tests validating goal-validator, quality-checker, and verifier modules. Tests confirm module exports, function behavior, and multi-layer orchestration work correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Test Suite 16 - Report Generation and Integration</name>
  <files>gsd/scripts/integration-test.js</files>
  <action>
    Add Test Suite 16 to integration-test.js for verification-report and end-to-end integration.

    Location: After Test Suite 15

    Import additions (add to top of file after Test Suite 15 imports):
    ```javascript
    import { generateVerificationReport, saveReport } from './verification-report.js';
    import { renderTemplate } from './template-renderer.js';
    ```

    Test Suite 16 structure (6 tests):

    ```javascript
    /**
     * Test Suite 16: Report Generation and Integration (Phase 8)
     */
    async function testReportGeneration() {
      console.log('\n=== Test Suite 16: Report Generation and Integration (Phase 8) ===');

      // Test 1: verification-report exports expected functions
      try {
        const hasGenerate = typeof generateVerificationReport === 'function';
        const hasSave = typeof saveReport === 'function';
        logTest('verification-report exports 2 functions', hasGenerate && hasSave);
      } catch (error) {
        logTest('verification-report exports 2 functions', false, error.message);
      }

      // Test 2: generateVerificationReport transforms results
      try {
        const mockResults = {
          phase: 8,
          passed: false,
          layers: {
            smoke: { passed: true, duration: '10s' },
            linting: { passed: true, errors: 0, warnings: 2 },
            unitTests: { passed: true, count: 81, coverage: 91 }
          },
          failures: ['Test failure example'],
          duration: 120
        };
        const vars = generateVerificationReport(mockResults);
        const passed = vars.phase === 8 &&
                      vars.passed === false &&
                      vars.failures_count === 1 &&
                      typeof vars.layers_smoke_passed === 'boolean';
        logTest('generateVerificationReport transforms results to variables', passed);
      } catch (error) {
        logTest('generateVerificationReport transforms results to variables', false, error.message);
      }

      // Test 3: VERIFICATION.md template exists and is valid
      try {
        const templatePath = gsdPath('templates', 'VERIFICATION.md');
        const exists = await fileExists(templatePath);
        const content = exists ? await readFile(templatePath) : '';
        const hasVariables = content.includes('${phase}') && content.includes('${passed}');
        logTest('VERIFICATION.md template exists and has variables', exists && hasVariables);
      } catch (error) {
        logTest('VERIFICATION.md template exists and has variables', false, error.message);
      }

      // Test 4: Template can be rendered with verification data
      try {
        const mockVars = {
          phase: 8,
          verified: '2026-01-21',
          timestamp: '2026-01-21T12:00:00Z',
          passed: true,
          failures_count: 0,
          duration: 120,
          layers_smoke_passed: true,
          layers_linting_passed: true,
          layers_unit_passed: true,
          failures: '',
          next_action: 'Phase verified.'
        };
        const rendered = await renderTemplate('VERIFICATION', mockVars);
        const passed = rendered.includes('phase: 8') && rendered.includes('passed: true');
        logTest('VERIFICATION template renders with verification variables', passed);
      } catch (error) {
        logTest('VERIFICATION template renders with verification variables', false, error.message);
      }

      // Test 5: verify-work.md updated with verifier.js integration
      try {
        const guidelinePath = gsdPath('guidelines', 'verify-work.md');
        const content = await readFile(guidelinePath);
        const hasVerifier = content.includes('verifier.js');
        const hasLayers = content.includes('Layer 1:') || content.includes('Verification Layers');
        logTest('verify-work.md integrated with new verification modules', hasVerifier && hasLayers);
      } catch (error) {
        logTest('verify-work.md integrated with new verification modules', false, error.message);
      }

      // Test 6: End-to-end verification workflow (integration)
      try {
        // Run verification on Phase 1 (should pass - already complete)
        const verificationResult = await verifyPhase(1);
        const hasLayers = verificationResult.layers &&
                         verificationResult.layers.smoke &&
                         verificationResult.layers.linting;
        const hasResults = typeof verificationResult.passed === 'boolean';

        // Generate report from results
        const reportVars = generateVerificationReport(verificationResult);
        const hasReportVars = reportVars.phase === 1 && typeof reportVars.passed === 'boolean';

        logTest('End-to-end verification workflow completes', hasLayers && hasResults && hasReportVars);
      } catch (error) {
        logTest('End-to-end verification workflow completes', false, error.message);
      }
    }
    ```

    Add to main test execution (after testVerificationModules() call):
    ```javascript
    await testReportGeneration();
    ```

    Update final summary (around line 1100+):
    ```javascript
    // Final summary
    console.log('\n=== Test Summary ===');
    console.log(`Total tests: ${totalTests}`);
    console.log(`Passed: ${passedTests} (${Math.round(passedTests/totalTests*100)}%)`);
    console.log(`Failed: ${failedTests}`);
    console.log('\nTest Suites:');
    console.log('  Suite 1-7: Phase 2 (Core Infrastructure)');
    console.log('  Suite 8-9: Phase 3 (Workflow Orchestration)');
    console.log('  Suite 10-11: Phase 4 (Advanced Features)');
    console.log('  Suite 12: Phase 6 (Discussion & Context System)');
    console.log('  Suite 13-14: Phase 7 (Enhanced Research Infrastructure)');
    console.log('  Suite 15-16: Phase 8 (Verification & Quality System)');
    ```
  </action>
  <verify>
    1. Test Suite 16 added after Test Suite 15
    2. 6 tests for report generation and integration
    3. Imports added for verification-report and renderTemplate
    4. testReportGeneration() called in main execution
    5. Tests validate report generation, template rendering, guideline integration, end-to-end workflow
    6. Final summary updated to list all 16 test suites with phase mapping
    7. All tests follow existing logTest pattern
    8. No syntax errors (file can be executed)
  </verify>
  <done>
    Test Suite 16 added to integration-test.js with 6 tests validating verification-report module, VERIFICATION.md template rendering, verify-work.md integration, and end-to-end verification workflow. Total test count: 95 tests (81 existing + 8 Suite 15 + 6 Suite 16).
  </done>
</task>

</tasks>

<verification>
Run these checks after task completion:

1. Execute full integration test suite:
   ```bash
   node gsd/scripts/integration-test.js
   ```
   Expected: 95 tests execute, 90%+ pass rate (some network tests may fail)

2. Verify Test Suite 15 coverage:
   ```bash
   node gsd/scripts/integration-test.js 2>&1 | grep -A 10 "Test Suite 15"
   ```
   Expected: 8 tests listed for verification modules

3. Verify Test Suite 16 coverage:
   ```bash
   node gsd/scripts/integration-test.js 2>&1 | grep -A 8 "Test Suite 16"
   ```
   Expected: 6 tests listed for report generation

4. Check total test count:
   ```bash
   node gsd/scripts/integration-test.js 2>&1 | grep "Total tests:"
   ```
   Expected: Total tests: 95

5. Validate end-to-end test:
   ```bash
   node -e "import('./gsd/scripts/verifier.js').then(async m => { const result = await m.verifyPhase(1); console.log('E2E test result:', result.passed ? 'PASS' : 'FAIL', '- Layers:', Object.keys(result.layers).length); })"
   ```
   Expected: E2E test result: PASS - Layers: 5
</verification>

<success_criteria>
1. Test Suite 15 added with 8 tests for verification modules
2. Test Suite 16 added with 6 tests for report generation and integration
3. All Phase 8 modules tested: goal-validator (3), quality-checker (2), verifier (3), verification-report (2)
4. VERIFICATION.md template rendering validated
5. verify-work.md integration validated (references verifier.js)
6. End-to-end verification workflow validated (verifyPhase â†’ generateReport)
7. Total test count: 95 tests (81 existing + 14 new)
8. Test pass rate: 90%+ (allowing for network-dependent tests)
9. Imports added correctly (no import errors)
10. All tests follow existing logTest pattern
11. Final summary updated with Phase 8 test suite mapping
12. integration-test.js executes without syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-verification-and-quality-system/08-04-SUMMARY.md`
</output>
