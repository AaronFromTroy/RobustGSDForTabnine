---
phase: 10-fix-path-handling-bugs-in-all-guidelines
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - gsd/guidelines/plan-phase.md
  - gsd/guidelines/execute-phase.md
  - gsd/guidelines/verify-work.md
  - gsd/guidelines/new-project.md
autonomous: true

must_haves:
  truths:
    - "mkdir commands create directories even when parent paths don't exist"
    - "Variable expansion in paths preserves slashes and special characters"
    - "File operations succeed with paths containing spaces or special characters"
    - "Git add commands handle variable-expanded paths correctly"
    - "Node script calls handle variable-expanded paths correctly"
  artifacts:
    - path: "gsd/guidelines/plan-phase.md"
      provides: "Corrected bash commands with quoting and -p flags"
      min_lines: 500
    - path: "gsd/guidelines/execute-phase.md"
      provides: "Corrected bash commands with quoting"
      min_lines: 200
    - path: "gsd/guidelines/verify-work.md"
      provides: "Corrected bash commands with quoting"
      min_lines: 250
    - path: "gsd/guidelines/new-project.md"
      provides: "Corrected bash commands with quoting and -p flags"
      min_lines: 200
  key_links:
    - from: "plan-phase.md line 41"
      to: "mkdir command"
      via: "proper quoting and -p flag"
      pattern: 'mkdir -p "\$\{PHASE_DIR\}"'
    - from: "plan-phase.md line 71"
      to: "git add command"
      via: "proper quoting"
      pattern: 'git add "\.planning/phases/\$\{PHASE_DIR\}/"'
    - from: "all guidelines"
      to: "node script calls"
      via: "proper quoting for paths with variables"
      pattern: 'node .* --output=".*\$\{.*\}"'
---

<objective>
Fix critical path handling bugs in workflow guidelines that cause directory creation failures when adding phases dynamically.

Purpose: Ensure all bash commands use proper quoting, `-p` flags, and error handling to prevent path construction issues like `.planningphases` instead of `.planning/phases/`.

Output: Updated guidelines with robust bash path handling that works reliably with variable expansion and special characters.
</objective>

<execution_context>
@C:/Projects/GSDForTabnine/.planning/STATE.md
@C:/Projects/GSDForTabnine/.planning/ROADMAP.md
</execution_context>

<context>
**Bug discovered during real-world usage:**
When adding a phase dynamically via Tabnine, the system created `.planningblahblah` directory in root instead of `.planning/phases/blahblah/`. This is caused by missing quotes and `-p` flags in bash commands.

**Root cause:**
```bash
# Current (BROKEN):
mkdir .planning/phases/${PHASE_DIR}

# Problems:
1. No quotes → word splitting can corrupt paths
2. No -p flag → won't create parent directories
3. When variable expansion fails, slashes get lost
```

**Impact scope:**
- plan-phase.md: 2 mkdir occurrences, multiple git add, multiple node calls
- execute-phase.md: Multiple git add and node calls
- verify-work.md: git add and node calls
- new-project.md: mkdir without -p, unquoted --output paths

**Pattern to apply:**
```bash
# Fixed:
mkdir -p ".planning/phases/${PHASE_DIR}"
git add ".planning/phases/${PHASE_DIR}/"
node script.js --output=".planning/phases/${PHASE_DIR}/file.md"
```

**Quote all paths containing variables to prevent word splitting.**
**Use -p flag on mkdir to create parent directories.**
**Add error handling where appropriate.**
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix plan-phase.md path handling</name>
  <files>gsd/guidelines/plan-phase.md</files>
  <action>
Fix all bash commands in plan-phase.md:

**Line 41 (Commands section - mkdir):**
```bash
# Before:
mkdir .planning/phases/${PHASE_DIR}

# After:
mkdir -p ".planning/phases/${PHASE_DIR}"
```
Why: -p creates parent directories if needed, quotes prevent word splitting

**Line 44 (Commands section - node template-renderer):**
```bash
# Before:
node gsd/scripts/template-renderer.js --template=PLAN --output=.planning/phases/${PHASE_DIR}/${PHASE}-${PLAN}-PLAN.md --phaseName="${PHASE_NAME}" --planNumber="${PLAN_NUM}"

# After:
node gsd/scripts/template-renderer.js --template=PLAN --output=".planning/phases/${PHASE_DIR}/${PHASE}-${PLAN}-PLAN.md" --phaseName="${PHASE_NAME}" --planNumber="${PLAN_NUM}"
```
Why: Quote --output path to prevent word splitting when variables expand

**Line 71 (Commands section - git add):**
```bash
# Before:
git add .planning/phases/${PHASE_DIR}/

# After:
git add ".planning/phases/${PHASE_DIR}/"
```
Why: Quotes ensure git receives correct path even with spaces/special chars

**Line 344 (Workflow Steps - mkdir instruction):**
```bash
# Before:
   - Execute: `mkdir .planning/phases/${PHASE_DIR}`

# After:
   - Execute: `mkdir -p ".planning/phases/${PHASE_DIR}"`
```
Why: Make documentation consistent with Commands section fix

Apply same pattern to all other variable-expanded paths in the file.
  </action>
  <verify>
```bash
# Verify all mkdir commands have -p flag
grep 'mkdir.*\.planning/phases' C:/Projects/GSDForTabnine/gsd/guidelines/plan-phase.md

# Verify all paths with variables are quoted
grep -E '(git add|node.*--output=|mkdir)' C:/Projects/GSDForTabnine/gsd/guidelines/plan-phase.md | grep -v '"'

# Second command should return empty (no unquoted variable paths)
```
  </verify>
  <done>All bash commands in plan-phase.md use proper quoting and mkdir has -p flag</done>
</task>

<task type="auto">
  <name>Task 2: Fix execute-phase.md path handling</name>
  <files>gsd/guidelines/execute-phase.md</files>
  <action>
Fix all bash commands in execute-phase.md:

**Line 22 (Commands section - node workflow-orchestrator):**
```bash
# Before:
node gsd/scripts/workflow-orchestrator.js --execute-plan=.planning/phases/${PHASE_DIR}/${PHASE}-${PLAN}-PLAN.md

# After:
node gsd/scripts/workflow-orchestrator.js --execute-plan=".planning/phases/${PHASE_DIR}/${PHASE}-${PLAN}-PLAN.md"
```

**Line 25 (Commands section - node template-renderer):**
```bash
# Before:
node gsd/scripts/template-renderer.js --template=SUMMARY --output=.planning/phases/${PHASE_DIR}/${PHASE}-${PLAN}-SUMMARY.md

# After:
node gsd/scripts/template-renderer.js --template=SUMMARY --output=".planning/phases/${PHASE_DIR}/${PHASE}-${PLAN}-SUMMARY.md"
```

**Line 31 (Commands section - git add):**
```bash
# Before:
git add .planning/phases/${PHASE_DIR}/${PHASE}-${PLAN}-SUMMARY.md

# After:
git add ".planning/phases/${PHASE_DIR}/${PHASE}-${PLAN}-SUMMARY.md"
```

Apply quoting to all other variable-expanded paths.
  </action>
  <verify>
```bash
# Verify all paths with variables are quoted
grep -E '(git add|node.*--(output|execute-plan)=).*\$\{' C:/Projects/GSDForTabnine/gsd/guidelines/execute-phase.md | grep -v '".*\$\{.*\}"'

# Should return empty (no unquoted variable paths)
```
  </verify>
  <done>All bash commands in execute-phase.md use proper quoting for variable-expanded paths</done>
</task>

<task type="auto">
  <name>Task 3: Fix verify-work.md path handling</name>
  <files>gsd/guidelines/verify-work.md</files>
  <action>
Fix all bash commands in verify-work.md:

**Line 28 (Commands section - git add):**
```bash
# Before:
git add .planning/STATE.md .planning/phases/${PHASE_DIR}/VERIFICATION.md

# After:
git add .planning/STATE.md ".planning/phases/${PHASE_DIR}/VERIFICATION.md"
```
Why: Second path contains variable, needs quotes

Apply quoting to all other variable-expanded paths in node commands and git commands.

**Pattern to apply throughout:**
- Any path containing `${VAR}` must be wrapped in double quotes
- Static paths (like `.planning/STATE.md`) don't need quotes but can have them for consistency
- Paths with spaces MUST have quotes
  </action>
  <verify>
```bash
# Verify all paths with variables are quoted
grep -E '(git add|node.*).*\$\{' C:/Projects/GSDForTabnine/gsd/guidelines/verify-work.md | grep -v '".*\$\{.*\}"'

# Should return empty (no unquoted variable paths)

# Test that fixed commands parse correctly in bash
bash -n <(grep -E '^(mkdir|git add|node)' C:/Projects/GSDForTabnine/gsd/guidelines/verify-work.md | sed 's/^```bash//; s/^```//')
```
  </verify>
  <done>All bash commands in verify-work.md use proper quoting for variable-expanded paths</done>
</task>

<task type="auto">
  <name>Task 4: Fix new-project.md path handling</name>
  <files>gsd/guidelines/new-project.md</files>
  <action>
Fix all bash commands in new-project.md:

**Line 190 (mkdir command):**
```bash
# Before:
mkdir .planning

# After:
mkdir -p ".planning"
```
Why: -p flag ensures command succeeds even if directory exists, quotes for consistency

**Line 46 (node script --output for PROJECT.md):**
```bash
# Before:
node gsd/scripts/template-renderer.js --template=PROJECT --output=.planning/PROJECT.md

# After:
node gsd/scripts/template-renderer.js --template=PROJECT --output=".planning/PROJECT.md"
```
Why: Quote --output path to prevent word splitting with special characters

**Line 49 (node script --output for REQUIREMENTS.md):**
```bash
# Before:
node gsd/scripts/template-renderer.js --template=REQUIREMENTS --output=.planning/REQUIREMENTS.md

# After:
node gsd/scripts/template-renderer.js --template=REQUIREMENTS --output=".planning/REQUIREMENTS.md"
```
Why: Quote --output path for consistency and safety

Apply same quoting pattern to all other paths in the file to prevent path handling issues.
  </action>
  <verify>
```bash
# Verify mkdir has -p flag
grep 'mkdir.*\.planning' C:/Projects/GSDForTabnine/gsd/guidelines/new-project.md | grep -v ' -p '
# Should return empty

# Verify all --output paths are quoted
grep -E 'node.*--output=' C:/Projects/GSDForTabnine/gsd/guidelines/new-project.md | grep -v '--output="'
# Should return empty (no unquoted --output paths)
```
  </verify>
  <done>All bash commands in new-project.md use proper quoting and mkdir has -p flag</done>
</task>

</tasks>

<verification>
## Overall verification

After all four tasks complete:

1. **Pattern compliance:**
```bash
# All mkdir commands should have -p flag
grep -r 'mkdir .*\.planning' C:/Projects/GSDForTabnine/gsd/guidelines/*.md | grep -v ' -p '
# Should return empty

# All variable paths should be quoted
grep -rE '(git add|node.*).*\$\{[^}]+\}' C:/Projects/GSDForTabnine/gsd/guidelines/*.md | grep -v '"[^"]*\$\{[^}]+\}[^"]*"'
# Should return empty (or only show lines where variable is already in quotes elsewhere)
```

2. **No malformed patterns:**
```bash
# Check for potential issues: .planningphases, missing slashes
grep -r 'planning[^/]' C:/Projects/GSDForTabnine/gsd/guidelines/*.md | grep -v '.planning/'
# Should only return comments/docs, not actual bash commands
```

3. **Test case simulation:**
Create a test scenario with problematic variable expansion:
```bash
# Simulate the original bug scenario
PHASE_DIR="04-something"
# Old pattern would fail:
# mkdir .planning/phases/${PHASE_DIR}  # Could create: .planningphases04-something

# New pattern succeeds:
mkdir -p ".planning/phases/${PHASE_DIR}"  # Creates: .planning/phases/04-something/
```

4. **Git validation:**
All four guideline files should pass markdown linting and have consistent formatting.
</verification>

<success_criteria>
1. All `mkdir` commands in plan-phase.md and new-project.md use `-p` flag
2. All bash paths containing variables are wrapped in double quotes across all four guidelines
3. Pattern grep commands return empty results (no unquoted variable paths)
4. Bash syntax check passes for all extracted commands
5. Test case with `PHASE_DIR="04-something"` creates correct directory structure
6. No `.planningphases` or similar malformed directories can be created
7. Git commits show only the four guideline files modified
</success_criteria>

<output>
After completion, create `.planning/phases/10-fix-path-handling-bugs-in-all-guidelines/10-01-SUMMARY.md` documenting:

- Number of path fixes applied (by file and by command type)
- Before/after examples of the fixes
- Verification results showing no unquoted paths remain
- Test case results demonstrating correct behavior

This ensures the critical bug is fixed and cannot reoccur when dynamically adding phases.
</output>
