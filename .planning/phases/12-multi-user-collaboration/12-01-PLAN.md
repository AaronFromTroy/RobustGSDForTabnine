---
phase: 12-multi-user-collaboration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .gitignore
  - gsd/scripts/setup-worktree.js
  - gsd/package.json
autonomous: true

must_haves:
  truths:
    - "STATE.md is not committed to Git (each developer has local copy)"
    - "Developers can create isolated worktrees with setup-worktree.js"
    - "Each worktree has its own .planning/ directory with gitignored STATE.md"
  artifacts:
    - path: ".gitignore"
      provides: "STATE.md exclusion from Git"
      contains: "STATE.md"
    - path: "gsd/scripts/setup-worktree.js"
      provides: "Worktree initialization for developers"
      exports: ["setupWorktree", "listWorktrees", "cleanupWorktree"]
      min_lines: 80
  key_links:
    - from: "setup-worktree.js"
      to: "git worktree add"
      via: "spawn child process"
      pattern: "spawn.*git.*worktree"
    - from: ".gitignore"
      to: ".planning/STATE.md"
      via: "exclusion pattern"
      pattern: "STATE\\.md"
---

<objective>
Establish workspace isolation foundation by adding STATE.md to .gitignore and creating worktree management script for branch-per-developer workflow.

Purpose: Enable multiple developers to work simultaneously without STATE.md conflicts by treating it as local working state while providing tooling for isolated workspace setup.

Output: .gitignore with STATE.md exclusion and setup-worktree.js script for creating/managing developer worktrees.
</objective>

<execution_context>
@C:/Projects/GSDForTabnine/.claude/get-stuff-done/workflows/execute-plan.md
@C:/Projects/GSDForTabnine/.claude/get-stuff-done/templates/summary.md
</execution_context>

<context>
@C:/Projects/GSDForTabnine/.planning/PROJECT.md
@C:/Projects/GSDForTabnine/.planning/ROADMAP.md
@C:/Projects/GSDForTabnine/.planning/STATE.md
@C:/Projects/GSDForTabnine/.planning/phases/12-multi-user-collaboration/12-RESEARCH.md

# Relevant prior work
@C:/Projects/GSDForTabnine/.planning/phases/02-core-infrastructure/02-03-SUMMARY.md
@C:/Projects/GSDForTabnine/gsd/scripts/state-manager.js
@C:/Projects/GSDForTabnine/gsd/scripts/process-runner.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add STATE.md to .gitignore</name>
  <files>.gitignore</files>
  <action>
Add STATE.md exclusion pattern to .gitignore to prevent committing local working state.

Research recommendation: "Add STATE.md to .gitignore (keep as local working state)" - prevents merge conflicts when multiple developers work simultaneously.

Changes:
1. Open .gitignore file
2. Add new section with comment "# GSD local state (per-developer)"
3. Add pattern "STATE.md" under the section
4. Add pattern ".planning/STATE.md" for explicit path exclusion
5. Maintain existing sections and formatting

Why this matters: STATE.md tracks current phase/plan/status for individual developers. Committing it causes guaranteed conflicts when multiple users work in parallel. Each worktree will have its own STATE.md that remains local.

Pattern placement: Add after "# Upgrade backups (local only)" section for logical grouping of GSD-specific exclusions.
  </action>
  <verify>
git check-ignore .planning/STATE.md returns ".planning/STATE.md" (confirms exclusion)
git status shows no changes to STATE.md even after modifying it
  </verify>
  <done>
.gitignore contains STATE.md exclusion pattern
Git no longer tracks .planning/STATE.md changes
Developers can maintain independent STATE.md files per worktree
  </done>
</task>

<task type="auto">
  <name>Task 2: Create worktree setup script</name>
  <files>gsd/scripts/setup-worktree.js, gsd/package.json</files>
  <action>
Create gsd/scripts/setup-worktree.js implementing Git worktree-based workspace isolation for branch-per-developer workflow.

Research pattern from 12-RESEARCH.md lines 616-683 (Worktree Setup Script for New Developers).

Functions to export (3 total):
1. setupWorktree(developerName, phaseNumber, worktreesDir = '../worktrees')
   - Creates Git worktree with branch name format: {developerName}/phase-{NN}
   - Worktree path: {worktreesDir}/{developerName}-phase-{phaseNumber}
   - Creates .planning/ directory in new worktree
   - Creates .planning/.gitignore with "STATE.md\n" content
   - Returns worktree metadata object: { worktreePath, branchName, planningDir }
   - Logs setup instructions for developer (cd, work, commit, push, PR)

2. listWorktrees()
   - Executes `git worktree list` via spawn
   - Parses stdout to return array of worktree objects: { path, branch, head }
   - Returns empty array if no worktrees found

3. cleanupWorktree(worktreePath)
   - Executes `git worktree remove {worktreePath}` via spawn
   - Logs confirmation message on success
   - Throws error if worktree removal fails

Implementation details:
- Use spawn from process-runner.js pattern (Phase 2) - import { spawn } from 'node:child_process', promisify for async/await
- Use ESM syntax: export async function setupWorktree(...)
- Use path.join for cross-platform path construction
- Use fs.mkdir with { recursive: true } for directory creation
- Use fs.writeFile for .gitignore creation
- Add executable shebang: #!/usr/bin/env node
- Add CLI support: if (import.meta.url.includes(process.argv[1])) { /* parse args, call setupWorktree */ }
- Error handling: wrap git commands in try-catch, provide actionable error messages
- Phase number padding: String(phaseNumber).padStart(2, '0') for 01, 02, etc.

Package.json updates:
- Add subpath export: "./setup-worktree": "./scripts/setup-worktree.js"
- Add to main index.js exports: setupWorktree, listWorktrees, cleanupWorktree

Do NOT use promisify(spawn) - spawn is already async, use promise wrapper or util.promisify(exec) for simpler command execution.

Why this approach: Git worktrees are official Git feature (since 2.5.0), share .git directory (saves disk space), enable parallel branch development without cloning repository multiple times.
  </action>
  <verify>
node gsd/scripts/setup-worktree.js alice 12 works (creates worktree)
git worktree list shows new worktree
ls ../worktrees/alice-phase-12/.planning/.gitignore exists with STATE.md content
ESLint passes (no syntax errors)
  </verify>
  <done>
setup-worktree.js exists with 3 exported functions (setupWorktree, listWorktrees, cleanupWorktree)
CLI execution creates worktree with branch name format {dev}/phase-{NN}
Each worktree has .planning/.gitignore excluding STATE.md
package.json includes setup-worktree subpath export
Script uses spawn for Git commands following existing patterns
  </done>
</task>

</tasks>

<verification>
1. .gitignore excludes STATE.md (git check-ignore confirms)
2. setup-worktree.js creates functional worktrees with isolated .planning/ directories
3. Git worktree list command shows created worktrees
4. Each worktree has .planning/.gitignore with STATE.md exclusion
5. Package exports include setup-worktree module
</verification>

<success_criteria>
- STATE.md excluded from Git (no more multi-user conflicts)
- Developers can create isolated worktrees via setup-worktree.js
- Each worktree has independent .planning/STATE.md (local working state)
- Worktree cleanup function provided for completed work
- Script follows existing GSD patterns (ESM, spawn, cross-platform paths)
</success_criteria>

<output>
After completion, create `.planning/phases/12-multi-user-collaboration/12-01-SUMMARY.md`
</output>
